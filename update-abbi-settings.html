<!DOCTYPE html>
<html>
<head>
    <title>Update ABBI Settings</title>
    <style>
        body {
            font-family: monospace;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        button {
            padding: 10px 20px;
            margin: 10px 5px;
            font-size: 16px;
            cursor: pointer;
        }
        .success { color: green; }
        .error { color: red; }
        pre {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>Update ABBI Agent Settings</h1>

    <h2>Quick Settings:</h2>
    <button onclick="makePatientAndSlow()">üê¢ Make Patient & Slow (Recommended)</button>
    <button onclick="getCurrentSettings()">üìã Get Current Settings</button>

    <h3>Manual Adjustments:</h3>
    <button onclick="updateSetting('turn_timeout', 4.0)">‚è±Ô∏è Turn Timeout: 4s</button>
    <button onclick="updateSetting('turn_timeout', 5.0)">‚è±Ô∏è Turn Timeout: 5s</button>
    <button onclick="updateSetting('stability', 0.7)">üéØ Stability: 0.7 (slower)</button>
    <button onclick="updateSetting('stability', 0.8)">üéØ Stability: 0.8 (very slow)</button>

    <div id="output"></div>

    <script>
        const AGENT_ID = 'agent_2501ketq01k7e4vrnbrvvefa99ej';

        function log(message, isError = false) {
            const output = document.getElementById('output');
            const div = document.createElement('div');
            div.className = isError ? 'error' : 'success';
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}:</strong> ${message}`;
            output.appendChild(div);
        }

        async function getCurrentSettings() {
            try {
                log('Fetching current agent settings...');
                const response = await fetch(`https://api.elevenlabs.io/v1/convai/agents/${AGENT_ID}`, {
                    headers: {
                        'xi-api-key': 'ELEVENLABS_API_KEY_HERE'
                    }
                });

                if (!response.ok) {
                    throw new Error('Failed to fetch agent settings');
                }

                const data = await response.json();
                const pre = document.createElement('pre');
                pre.textContent = JSON.stringify(data.conversation_config, null, 2);
                document.getElementById('output').appendChild(pre);
                log('Current settings retrieved');
            } catch (error) {
                log('Error: ' + error.message, true);
            }
        }

        async function makePatientAndSlow() {
            const settings = {
                conversation_config: {
                    turn: {
                        turn_timeout: 4.5,  // Wait 4.5 seconds before prompting
                        turn_eagerness: 0.3  // Low eagerness = more patient
                    },
                    tts: {
                        stability: 0.75,  // Higher stability = slower, more deliberate
                        similarity_boost: 0.75
                    }
                }
            };

            try {
                log('Updating agent to be patient and slow...');
                const response = await fetch('/api/update-agent-settings', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        agent_id: AGENT_ID,
                        settings: settings
                    })
                });

                const result = await response.json();

                if (result.success) {
                    log('‚úÖ Agent updated successfully!');
                    log('- Turn timeout: 4.5 seconds (more patient)');
                    log('- Turn eagerness: 0.3 (won\'t interrupt quickly)');
                    log('- Stability: 0.75 (slower, clearer speech)');
                    const pre = document.createElement('pre');
                    pre.textContent = JSON.stringify(result.agent.conversation_config, null, 2);
                    document.getElementById('output').appendChild(pre);
                } else {
                    log('‚ùå Update failed: ' + result.error, true);
                }
            } catch (error) {
                log('‚ùå Error: ' + error.message, true);
            }
        }

        async function updateSetting(key, value) {
            let settings = {};

            if (key === 'turn_timeout') {
                settings = {
                    conversation_config: {
                        turn: {
                            turn_timeout: value
                        }
                    }
                };
            } else if (key === 'stability') {
                settings = {
                    conversation_config: {
                        tts: {
                            stability: value
                        }
                    }
                };
            }

            try {
                log(`Updating ${key} to ${value}...`);
                const response = await fetch('/api/update-agent-settings', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        agent_id: AGENT_ID,
                        settings: settings
                    })
                });

                const result = await response.json();

                if (result.success) {
                    log(`‚úÖ ${key} updated to ${value}`);
                } else {
                    log('‚ùå Update failed: ' + result.error, true);
                }
            } catch (error) {
                log('‚ùå Error: ' + error.message, true);
            }
        }
    </script>
</body>
</html>
