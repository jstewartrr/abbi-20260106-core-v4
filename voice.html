<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ABBI Voice</title>
    <script type="module">
        import { Conversation } from 'https://esm.sh/@elevenlabs/client@0.19.1';
        window.ElevenLabsConversation = Conversation;
    </script>
    <style>
        elevenlabs-convai{display:none!important}
        :root{--bg:#0a0a12;--purple:#8b5cf6;--green:#22c55e;--amber:#f59e0b;--text:#f1f5f9;--text2:#94a3b8}
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:system-ui,sans-serif;background:var(--bg);color:var(--text);min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center}
        .title{font-size:2rem;font-weight:700;margin-bottom:8px;background:linear-gradient(90deg,#3b82f6,var(--purple));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .subtitle{color:var(--text2);margin-bottom:40px}
        .avatar-btn{cursor:pointer;-webkit-tap-highlight-color:transparent}
        .avatar{width:280px;height:280px;border-radius:50%;object-fit:cover;border:4px solid var(--purple);box-shadow:0 0 40px rgba(139,92,246,0.4);transition:all .2s}
        .avatar-btn:hover .avatar{transform:scale(1.05)}
        .avatar-btn.connecting .avatar{animation:pa 1.5s infinite;border-color:var(--amber)}
        .avatar-btn.listening .avatar{animation:pp 1.2s infinite}
        .avatar-btn.speaking .avatar{animation:pg 1s infinite;border-color:var(--green)}
        @keyframes pa{0%,100%{box-shadow:0 0 30px rgba(245,158,11,0.4)}50%{box-shadow:0 0 60px rgba(245,158,11,0.8)}}
        @keyframes pp{0%,100%{box-shadow:0 0 30px rgba(139,92,246,0.4)}50%{box-shadow:0 0 70px rgba(139,92,246,0.9)}}
        @keyframes pg{0%,100%{box-shadow:0 0 30px rgba(34,197,94,0.4)}50%{box-shadow:0 0 70px rgba(34,197,94,0.8)}}
        .status{margin-top:24px;color:var(--text2)}
        .back{position:fixed;top:20px;left:20px;color:var(--text2);text-decoration:none}
        .back:hover{color:var(--text)}
    </style>
</head>
<body>
    <a href="/" class="back">‚Üê Back</a>
    <h1 class="title">ABBI</h1>
    <p class="subtitle">Adaptive Second Brain Intelligence</p>
    <div class="avatar-btn" id="btn">
        <img src="https://lh3.googleusercontent.com/d/1mEGmRYYQ_3exRbYYF7CyznYvcrHzPrPs=w400" class="avatar" alt="ABBI">
    </div>
    <p class="status" id="st">Tap to talk</p>
    <script>
        let c=null;const b=document.getElementById('btn'),s=document.getElementById('st');
        function set(x,t){b.className='avatar-btn '+x;s.textContent=t}
        async function go(){
            if(c){await c.endSession();c=null;set('','Tap to talk');return}
            set('connecting','Connecting...');
            try{
                const C=window.ElevenLabsConversation;
                if(!C){set('','Loading...');return}
                c=await C.startSession({
                    agentId:'agent_0001kcva7evzfbt9q5zc9n2q4vaz',
                    connectionType:'webrtc',
                    onConnect:()=>set('listening','Listening...'),
                    onDisconnect:()=>{c=null;set('','Tap to talk')},
                    onError:()=>{c=null;set('','Error - tap retry')},
                    onModeChange:m=>set(m.mode==='speaking'?'speaking':'listening',m.mode==='speaking'?'ABBI speaking...':'Listening...')
                });
            }catch(e){set('',e.name==='NotAllowedError'?'Allow mic':'Error')}
        }
        b.onclick=go;
    </script>
</body>
</html>